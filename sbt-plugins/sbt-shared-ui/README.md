sbt-shared-ui
===================

SBT plugin that enables sharing UI components via a shared UI SBT subproject.

See the `example` project for detailed usage.

## Getting Started ##

To start using the `sbt-shared-ui` plugin, you first must add it as a plugin to your SBT project:

In `[project root]/project/plugins.sbt`, add the following:

    val nexus = "http://utility.allenai.org:8081/nexus/content/repositories/releases"

    credentials += Credentials(
      "Sonatype Nexus Repository Manager",
      "utility.allenai.org",
      <username>,
      <password>)

    resolvers += "AllenAI" at nexus

    addSbtPlugin("org.allenai.plugins" % "sbt-shared-ui" % <VERSION>)

Now you can use the plugin in your build file (either `build.sbt` or `project/Build.scala`). You will need to define a subproject containing the UI resources you wish to share. See the "UI Project Directory Structure" section for details.

```scala
// In build.sbt

// The shared project (name is arbitrary)
lazy val sharedUi = project.in(file("shared-ui"))
  .settings(SharedUiPlugin.uiSettings: _*)

// A UI project that depends on shared
lazy val frontend = project.in(file("frontend"))
  .dependsOn(sharedUi)
  .settings(SharedUiPlugin.uiSettings: _*)
  .settings(SharedUiPlugin.uses(sharedUi): _*)

// Another UI project that depends on shared
lazy val anotherFrontend = project.in(file("another-frontend"))
  .dependsOn(sharedUi)
  .settings(SharedUiPlugin.uiSettings: _*)
  .settings(SharedUiPlugin.uses(sharedUi): _*)
```

### UI Project Directory Structure ###

The `sbt-shared-ui` plugin leverages Typesafe's [sbt-jshint-plugin](https://github.com/typesafehub/sbt-jshint-plugin) which in turn depends on Typesafe's [sbt-web](https://github.com/typesafehub/sbt-web) plugin infrastructure for javascript execution and web asset directory conventions. We are using the default's defined by `sbt-web`, which means that a UI project should put all managed HTML, CSS, and JS in a `src/main/assets/` directory. The directory can have any subdirectories, but as a convention, we will use:

```
src/main/assets/                  # managed sources (will be run through sbt-web plugins)
                [package]/js      # javascript sources
                [package]/css     # CSS sources
                [package]/less    # Less CSS sources
                [package]/html    # HTML sources
                [package]/images  # image files

src/main/public                   # unmanaged sources (will just be copied to managed resources as is)
```

where the [pacakge] should be a unique name within the parent project such as the subproject's name.

### Using Shared Project Assets from a Dependent Project ###

SBT _managed resource_ assets generated by a shared UI project are simply copied into the dependent projects' managed resources,
will be by default accessible at:

```
/public/[path/to/resource]
```

where the `[path/to/resource]` is the path after `/src/main/assets/` or `/src/main/public` in the shared UI project. This is why it
is important to package (at least common) projects' assets into uniquely named subdirectories.

#### Packaging ####

You may have a project that depends on more than one shared projects. As a best practice to avoid collisions, you will
want to package each project's assets into a unique namespace. For example, say you have an SBT project with
the following subproject `src` directory contents:

```
root/
     shared/src/main/assets/
                            shared/
                                  js/util.js
                                  html/template/header.html
                                  less/main.less
                    /public/vender/
                                   angular.js
                                   lo-dash.js
     ui1/src/main/assets/ui1/{js/,html/,less/}
     ui2/src/main/assets/ui2/{js/,html/,less/}
```

In `build.sbt`, you have:

```scala
lazy val shared = project.in(file("shared"))
  .settings(SharedUiPlugin.uiSettings: _*)

lazy val ui1 = project.in(file("ui1"))
  .dependsOn(sharedUi)
  .settings(SharedUiPlugin.uiSettings: _*)
  .settings(SharedUiPlugin.uses(shared): _*)

lazy val ui2 = project.in(file("another-frontend"))
  .dependsOn(ui1)
  .settings(SharedUiPlugin.uiSettings: _*)
  .settings(SharedUiPlugin.uses(ui1): _*)
```

and `ui1` depends on `shared`, and `ui2` depends on `ui1`. After compiling the project, the `[project]/target/public` directories will look like:

```
root/*shared*/target/public/
                            shared/
                                   js/util.js
                                   html/template/header.html
                                   less/main.less
                                   *less/main.css*
                            vendor/
                                   angular.js
                                   lo-dash.js
root/*ui1*/target/public/
                         *ui1*/{js/,html/,less/}
                         shared/
                                js/util.js
                                html/template/header.html
                                less/main.less
                                less/main.css
                         vendor/
                                angular.js
                                lo-dash.js
root/*ui2*/target/public/
                         ui1/{js/,html/,less/}
                         *ui2*/{js/,html/,less/}
                         shared/
                                js/util.js
                                html/template/header.html
                                less/main.less
                                less/main.css
                         vendor/
                                angular.js
                                lo-dash.js
```

#### Serving Web Resources from a Spray Server ####

In a Spray app, you'll want to define an `assets` route that will serve web assets like so:

```scala
def routes =
  path("assets" / Rest) { rest =>
    getFromResource(s"public/$rest")
  }
```

Then, you could use the assets in an HTML files like:

```html
<!-- in ui2/src/main/public/ui2/index.html -->
<html>
  <head>
    <!-- Imports -->
    <script src="/assets/vendor/angular.js"></script>
    <script src="/assets/vendor/lo-dash.js"></script>
    <script src="/assets/shared/js/util.js"></script>

    <!-- From this project -->
    <script src="/assets/ui2/js/main.js"></script>
    <link rel="stylesheet" href="/assets/ui2/less/main.css">
  </head>
  ...
</html>
```

## Web Asset  ##

The `shared-ui-plugin` provides jshint and Less CSS compile-time processing of web assets (javascript and Less files, respectively).

### Less CSS ###

Less CSS is a superset of CSS that adds nice features such as:

- Variables
- Mixins
- Functions

See http://lesscss.org/ to learn more about Less CSS.

A nice feature that Less CSS provides is the ability to generate a single CSS file from multiple
Less source files. By default, all Less source files are converted into a corresponding CSS
file by the Less compiler. The `shared-ui-plugin` provides a setting that can be used to specify
a single (or multiple) main Less source files to process into CSS. This is easier to explain with
an example:

Say you have the following Less source files:

```
src/main/assets/less
                    /main.less
                    /colors.less
                    /directives
                               /ari-details.less
                               /ari-logo.less
```

and you want to end up with a single `main.css` file that combines all of the Less files for use in the UI.

To do so, you need to use `import` in `main.less` as follows:

```less
// in main.less
import "colors.less";
import "directives/ari-details.less";
import "directives/ari-logo.less";
```

And then let the `sbt-shared-ui` plugin know it should only process the `main.less` file:

```scala
// in build.sbt
lazy val sharedUi = project.in(file("shared-ui"))
  .settings(SharedUiPlugin.uiSettings: _*)
  .settings(
    SharedUiPlugin.SharedUiKeys.lessFilter := Some("main.less")
  )
```

This will tell the Less compiler to only process the `main.less` root file and generate a `main.css`
that will combine all of the imported Less sources (outputted as CSS).

#### Importing Less files from shared projects ####

You can import Less files from shared subprojects as in the following example:

```less
// In [root]/ui1/src/main/assets/ui1/less/main.less
@import "../../../../../target/public/shared/less/util.less";
// Now you have styles, mixins, and variables defined in shared/less/util.less
.ui1 {
  .background-color: @bg-color; // defined in shared/less/util.less
}
```
