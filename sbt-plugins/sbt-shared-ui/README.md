sbt-shared-ui
===================

SBT plugin that enables sharing UI components via a shared UI SBT subproject.

See the `example` project for detailed usage.

## Getting Started ##

To start using the `sbt-shared-ui` plugin, you first must add it as a plugin to your SBT project:

In `[project root]/project/plugins.sbt`, add the following:

    val nexus = "http://utility.allenai.org:8081/nexus/content/repositories/releases"

    credentials += Credentials(
      "Sonatype Nexus Repository Manager",
      "utility.allenai.org",
      <username>,
      <password>)

    resolvers += "AllenAI" at nexus

    addSbtPlugin("org.allenai.plugins" % "sbt-shared-ui" % <VERSION>)

Now you can use the plugin in your build file (either `build.sbt` or `project/Build.scala`). You will need to define a subproject containing the UI resources you wish to share. See the "UI Project Directory Structure" section for details.

```scala
// In build.sbt

// The shared project (name is arbitrary)
lazy val sharedUi = project.in(file("shared-ui"))
  .settings(SharedUiPlugin.sharedProjectSettings: _*)

// A UI project that depends on shared
lazy val frontend = project.in(file("frontend"))
  .dependsOn(sharedUi)
  .settings(SharedUiPlugin.dependentProjectSettings(sharedUi): _*)

// Another UI project that depends on shared
lazy val anotherFrontend = project.in(file("another-frontend"))
  .dependsOn(sharedUi)
  .settings(SharedUiPlugin.dependentProjectSettings(sharedUi): _*)
```

### UI Project Directory Structure ###

The `sbt-shared-ui` plugin leverages Typesafe's [sbt-jshint-plugin](https://github.com/typesafehub/sbt-jshint-plugin) which in turn depends on Typesafe's [sbt-web](https://github.com/typesafehub/sbt-web) plugin infrastructure for javascript execution and web asset directory conventions. We are using the default's defined by `sbt-web`, which means that a UI project should put all managed HTML, CSS, and JS in a `src/main/assets/` directory. The directory can have any subdirectories, but as a convention, we will use:

```
src/main/assets         # managed sources (will be run through sbt-web plugins)
               /js      # javascript sources
               /css     # CSS sources
               /html    # HTML sources
               /images  # image files

src/main/public         # unmanaged sources (will just be copied to managed resources as is)
```

### Using Shared Project Assets from a Dependent Project ###

The path to SBT _managed resource_ assets generated by a shared UI project will be by default accessible at:

```
/public/shared/[path/to/resource]
```

where the `[path/to/resource]` is the path after `/src/main/assets/` or `/src/main/public` in the shared UI project.

#### Overriding the `shared` Namespace ####

You may have a project that depends on more than one shared projects. In this case, you will
probably want to specify namespaces to avoid resource collsions between the shared projects.

You can specify a different namespace than `shared` when adding the dependent project settings like so:

```scala
lazy val frontend = project.in(file("frontend"))
  .dependsOn(sharedUi)
  .dependsOn(anotherSharedUi)
  .settings(SharedUiPlugin.dependentProjectSettings(sharedUi, namespace = "foo"): _*)
  .settings(SharedUiPlugin.dependentProjectSettings(anotherSharedUi, namespace = "bar"): _*)
```

In this example, the shared resources from `sharedUi` will be placed in the `foo` namespace,
and shared resources from `anotherSharedUi` will be placed in the `bar` namespace. These assets
will be accessible via:

```
/public/foo/[path/to/sharedUi/resource]
/public/bar/[path/to/anotherSharedUi/resource]
```

#### Serving Web Resources from a Spray Server ####

In a Spray app, you'll want to define an `assets` route that will serve web assets like so:

```scala
def routes =
  path("assets" / Rest) { rest =>
    getFromResource(s"public/$rest")
  }
```

This will serve assets generated by the shared UI project as well as the current dependent subproject. For example, to use a javscript file from a shared UI project where the source is in:

`shared-ui/src/main/assets/js/shared.js`

You would add a `script` tag in your dependent project HTML file:

```html
<!-- in frontend/src/main/public/index.html -->
<html>
  <head>
    <!-- Import the shared JS file -->
    <script src="/assets/shared/js/shared.js"></script>

    <!-- Import this project's main JS file which depends on the shared JS file -->
    <script src="/assets/js/frontend.js"></script>
  </head>
  ...
</html>
```
