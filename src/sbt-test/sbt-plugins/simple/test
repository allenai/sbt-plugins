# See https://eed3si9n.com/testing-sbt-plugins for sbt-scripted test syntax
# initialize a git repository to make our plugins happy
$ exec git init
# Remove any hooks (such as the formatting hook), since it in particular will cause errors.
$ exec rm -r .git/hooks
$ exec mkdir .git/hooks
$ exec git add .
$ exec git commit -m "initial commit"

> checkCompileDoesNotFormat

> checkFormat

# Make sure all our code compiles, including:
# core/src/it test code that depends on core/src/test code
> core/it:compile

# Style plugin tests.
> checkStyle
> core/styleCheckStrict
-> core/test:styleCheckStrict

# Git-hook generation tests.
-$ exists .git/hooks/pre-commit
-$ exists .git/hooks/scalariform.jar

> generateAutoformatGitHook
$ exists .git/hooks/pre-commit
$ exists .git/hooks/scalariform.jar

# Test that docker dependency staging works.
> docker/dockerDependencyStage
$ exists docker/target/docker/dependencies/Dockerfile
# Test that we get the startup script copied.
$ exists docker/target/docker/dependencies/bin/run-docker.sh
# Assert that the joda-time dependency was added.
$ exists docker/target/docker/dependencies/lib/joda-time.joda-time-2.4.jar
